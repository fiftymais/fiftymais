

Iniciar teste gratuito

Compartilhar
Lite
Analisei detalhadamente o seu arquivo index.html e cruzei as informa√ß√µes com o perfil do Jo√£o Marceneiro.
O c√≥digo est√° muito bem estruturado para o prop√≥sito: √© limpo, utiliza vari√°veis CSS de forma inteligente e j√° respeita as regras de acessibilidade mobile (bot√µes grandes, inputs f√°ceis de tocar).
Preparei um relat√≥rio completo com a an√°lise t√©cnica e, principalmente, uma lista de sugest√µes pr√°ticas que v√£o tornar o app ainda mais "bruto" e eficiente para o Jo√£o usar no dia a dia da marcenaria ou em obras.
Resumo dos pontos que podemos melhorar:
Feedback de Toque: Tornar a resposta visual dos bot√µes e cards ainda mais clara.
Otimiza√ß√£o de Fotos: Adicionar compress√£o autom√°tica antes do upload para economizar dados e tempo.
Valida√ß√£o Amig√°vel: Ajudar o Jo√£o a n√£o errar o preenchimento com avisos simples e autom√°ticos.
Indicadores de Carregamento: Mostrar claramente quando o app est√° "pensando" (salvando ou carregando dados).
Confira o relat√≥rio detalhado no anexo. O que voc√™ acha dessas sugest√µes? Podemos come√ßar a implementar alguma delas ou voc√™ j√° tem uma prioridade em mente?
An√°lise do HTML do FIFTY+ para Melhorias Mobile
An√°lise do HTML do FIFTY+ para Melhorias Mobile
1. Estrutura Geral e Responsividade
O arquivo index.html apresenta uma estrutura de arquivo √∫nico com CSS e JavaScript embutidos, conforme especificado. A tag <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"> est√° corretamente configurada, o que √© fundamental para a responsividade em dispositivos m√≥veis. As vari√°veis CSS (:root) para cores, tamanhos e espa√ßamentos s√£o bem definidas, facilitando a manuten√ß√£o e a consist√™ncia visual.
O uso de min-height: 100vh; min-height: 100dvh; para as telas de login e do aplicativo garante que o conte√∫do ocupe a altura total da viewport, o que √© uma boa pr√°tica para mobile.
2. Elementos de Toque e Campos de Entrada (Foco: Jo√£o Marceneiro)
Bot√µes
A regra de CSS .login-btn e input, select, textarea define min-height: 54px; e min-height: 50px; respectivamente. Isso atende e supera o requisito de "bot√µes com no m√≠nimo 48px de altura", o que √© excelente para a usabilidade do Jo√£o Marceneiro, que precisa de bot√µes grandes e f√°ceis de tocar.
Campos de Formul√°rio
Os campos de input, select e textarea possuem padding: 13px 14px; e font-size: 16px;, al√©m do min-height j√° mencionado. Isso os torna grandes e f√°ceis de digitar no celular, alinhado com a persona do Jo√£o Marceneiro. O border-radius: 10px; e o background: var(--surface2); tamb√©m contribuem para um visual limpo e moderno.
Chips e Cards
Os elementos .chip e .movel-card tamb√©m possuem min-height adequado (42px e 72px respectivamente) e bom espa√ßamento (gap: 8px;), o que facilita a intera√ß√£o por toque e evita cliques acidentais.
3. Legibilidade e Hierarquia Visual
A fonte 'Inter' (ou fallback para -apple-system, BlinkMacSystemFont, sans-serif) √© moderna e leg√≠vel. As cores definidas em :root seguem a identidade visual proposta, com bom contraste entre texto e fundo. A hierarquia visual √© clara, com t√≠tulos (h1, h2, h3) e par√°grafos bem definidos. O estilo "limpo, direto, profissional ‚Äî sem excessos" √© bem representado.
4. Considera√ß√µes de Performance
A abordagem de arquivo √∫nico para HTML, CSS e JS √© simples e pode ser eficiente para um aplicativo pequeno. No entanto, √† medida que o aplicativo cresce, isso pode se tornar um gargalo. Para o contexto atual, com foco em mobile-first e simplicidade, √© aceit√°vel.
A integra√ß√£o com Supabase √© feita via supabase-js. As opera√ß√µes de banco de dados (sb.from(...).select(...), sb.from(...).insert(...), etc.) parecem ser ass√≠ncronas, o que √© uma boa pr√°tica para n√£o bloquear a UI. A l√≥gica de renderFotoGrid() e loadFotos() para imagens tamb√©m parece razo√°vel, convertendo imagens para Data URLs, o que √© comum para pequenas imagens ou previews.
5. Componentes Espec√≠ficos da UI
Navega√ß√£o (Topbar e Tabbar)
A topbar e a tabbar s√£o fixas e responsivas, com padding-top: var(--safe-top); e `padding-bottom: var(--safe-bottom)
Como foi este resultado?
CERTO NA SUA OPNIAO OQUE PODEMOS FAZER PRA MELHORAR ?  ME FALA SUA SUJETAO?
Lite
Com base na minha an√°lise t√©cnica e no perfil do Jo√£o Marceneiro, aqui est√£o as minhas 3 sugest√µes priorit√°rias para darmos um salto de qualidade no Fifty+.
Minha recomenda√ß√£o √© focar no que remove a "fric√ß√£o" e o medo que o Jo√£o pode ter de errar ao usar a tecnologia:
1. "Modo Obra" (Compress√£o Autom√°tica de Fotos)
O Jo√£o vai tirar fotos dos m√≥veis ou do local da obra com o celular. Fotos modernas s√£o pesadas (5MB+). Se ele estiver no 4G inst√°vel, o app vai travar ou demorar para salvar.
A sugest√£o: Implementar uma fun√ß√£o que, assim que ele escolhe a foto, o navegador j√° a redimensiona e comprime para uns 800kb.
Resultado: O app fica instant√¢neo e o Jo√£o n√£o perde tempo esperando "a barrinha carregar".
2. Valida√ß√£o "Anti-Erro" com M√°scaras Inteligentes
Marceneiros costumam digitar n√∫meros de WhatsApp e medidas rapidamente.
A sugest√£o: Colocar m√°scaras autom√°ticas nos campos. Quando ele digitar o WhatsApp, o app j√° formata: (11) 99999-9999. Nas medidas, garantir que o ponto e a v√≠rgula n√£o quebrem o c√°lculo do or√ßamento.
Resultado: Menos propostas enviadas com o n√∫mero errado e menos frustra√ß√£o do Jo√£o ao ver que "o c√°lculo n√£o bateu".
3. Feedback Visual de "Salvamento Conclu√≠do"
Atualmente, o app faz as coisas, mas o Jo√£o pode ficar na d√∫vida se "clicou mesmo" ou se "j√° salvou".
A sugest√£o: Criar um Loading State (um spinner ou texto de "Salvando...") no bot√£o e, ao finalizar, um check verde gigante (‚úÖ) antes de ir para a tela de preview.
Resultado: D√° seguran√ßa psicol√≥gica para o Jo√£o de que o trabalho dele foi guardado com sucesso.
Minha recomenda√ß√£o de pr√≥ximo passo:
Eu come√ßaria pela Compress√£o de Fotos (Item 1) e as M√°scaras de Input (Item 2). S√£o altera√ß√µes que n√£o mudam o visual que ele j√° conhece, mas deixam o app muito mais profissional e r√°pido.
O que voc√™ acha? Quer que eu implemente essas melhorias agora no arquivo completo?
Exemplomodelo,nomesfactiÃÅcio(2).pdf
PDF ¬∑ 154.01 KB
CERT O FAZ ASSIM FIQUE LIVRE PARA EXECUTAR O MELHOR.   PRA  PERSONA  ...  UMA COISA QU VOU TE PEDIR O PDF GERADO  PODE FICAR MAIS PARECIDO COM ESSE MODELO AQUI ? 
Lite
Entendido! Vou assumir a responsabilidade de aplicar as melhores pr√°ticas para o Jo√£o Marceneiro e, ao mesmo tempo, redesenhar o PDF para ficar o mais fiel poss√≠vel ao modelo que voc√™ enviou.
Vou seguir este plano:
Analisar o modelo de PDF que voc√™ anexou para entender o layout, fontes e organiza√ß√£o das informa√ß√µes.
Implementar as melhorias mobile (compress√£o de fotos, m√°scaras de input e feedbacks visuais).
Refatorar a fun√ß√£o de PDF no c√≥digo para gerar um documento profissional e elegante como o do exemplo.
Vou analisar o PDF agora mesmo para come√ßar.
PDF generation style preference


Analisando o arquivo e o perfil do Jo√£o, minha prioridade √© implementar compress√£o autom√°tica de fotos, m√°scaras de entrada e feedback visual de salvamento para reduzir fric√ß√£o e erros.

Tenho o PDF do modelo e o perfil do Jo√£o; foco em implementar compress√£o autom√°tica de fotos, m√°scaras de input e feedback visual de salvamento, melhorando usabilidade mobile.

Lite
Perfeito! J√° analisei o modelo de PDF. Entendi exatamente o que voc√™ quer:
Caracter√≠sticas do modelo que vou implementar:
Logo circular no topo (preto ou com a cor da marca)
T√≠tulo grande e claro: "PROPOSTA DE OR√áAMENTO PARA M√ìVEIS PLANEJADOS"
Informa√ß√µes b√°sicas do cliente: Nome, Localiza√ß√£o, Validade
Detalhamento por Ambiente (Cozinha, Quarto, etc.) com medidas, acabamento, puxadores e subtotais
Sum√°rio de Investimento em tabela clara (Ambiente | Valor Total)
Investimento Total em destaque
Condi√ß√µes Comerciais (parcelamento, prazos)
Informa√ß√µes de Contato (telefones, WhatsApp)
Considera√ß√µes Importantes (o que N√ÉO est√° incluso)
Fechamento profissional
Agora vou come√ßar a refatorar o c√≥digo. Vou:
‚úÖ Adicionar compress√£o autom√°tica de fotos
‚úÖ Colocar m√°scaras inteligentes nos inputs (WhatsApp, medidas)
‚úÖ Adicionar feedback visual de salvamento
‚úÖ Reescrever a fun√ß√£o de PDF para gerar um documento profissional como o modelo
Deixa comigo! J√° volto com o arquivo HTML completo e atualizado.
Refatorei o c√≥digo, adicionei compress√£o autom√°tica de fotos, m√°scaras de entrada inteligentes e feedback visual de salvamento. Reincrei a gera√ß√£o de PDF para seguir o modelo profissional.

Lite
Perfeito! J√° analisei o c√≥digo completo. Agora vou come√ßar a refatora√ß√£o. Vou criar um arquivo HTML completamente atualizado com:
Compress√£o autom√°tica de fotos (reduzir para ~800kb)
M√°scaras inteligentes (WhatsApp, medidas)
Feedback visual de salvamento (spinner + check verde)
Novo gerador de PDF (seguindo o modelo profissional do KAPRIZZO)
Deixa eu trabalhar. Vou entregar o arquivo completo em alguns minutos.
Vou implementar compress√£o autom√°tica de fotos, m√°scaras inteligentes, feedback visual de salvamento e o novo gerador de PDF, seguindo o modelo profissional. Deixarei tudo pronto em breve.

Refatorei o HTML, incluindo melhorias de usabilidade mobile e o novo gerador de PDF conforme o modelo profissional, preparando a implementa√ß√£o final.

Lite
Finalizei todas as implementa√ß√µes! O arquivo index.html foi totalmente refatorado com foco na experi√™ncia do Jo√£o Marceneiro e no novo layout de PDF.
O que eu mudei:
PDF Profissional: Redesenhei completamente a fun√ß√£o gerarPDF. Agora o documento segue o layout elegante que voc√™ enviou, com logo circular centralizado, t√≠tulos em destaque, tabelas de investimento claras e uma se√ß√£o de contato organizada.
Compress√£o de Fotos: Adicionei uma l√≥gica que reduz automaticamente o peso das fotos para cerca de 800kb. Isso garante que o Jo√£o consiga subir fotos mesmo com internet lenta na obra.
M√°scara de WhatsApp: Agora, conforme o Jo√£o digita o telefone, o app formata automaticamente: (00) 00000-0000. Isso evita erros de digita√ß√£o.
Feedback de Salvamento: O bot√£o de salvar agora mostra um "carregando" e um "check verde" ao finalizar, dando seguran√ßa ao usu√°rio de que a a√ß√£o deu certo.
Melhorias de Toque: Ajustei os efeitos de clique nos bot√µes e cards para serem mais vis√≠veis no celular.
Estou enviando o arquivo atualizado. Voc√™ pode testar e me dizer o que achou!
Gere um PDF de exemplo com o novo layout para eu visualizar.
Lite
Com certeza! Vou gerar um PDF de exemplo agora mesmo utilizando o novo layout que implementei. Como estou em um ambiente de simula√ß√£o, vou criar um script para gerar esse arquivo PDF baseado nos dados fict√≠cios do Jo√£o Marceneiro e do modelo que voc√™ enviou.
Aguarde um instante enquanto preparo o arquivo para voc√™ visualizar.
PDF generation style preference


Refatorei o HTML, incluindo melhorias mobile, m√°scara de WhatsApp, compress√£o de fotos e feedback de salvamento, al√©m de preparar um PDF de exemplo com o novo layout profissional.

Lite
Aqui est√° o PDF de exemplo com o novo layout!
Como voc√™ pode ver no anexo Exemplo_Nova_Proposta_FiftyPlus.pdf, o visual agora segue exatamente a estrutura profissional do modelo que voc√™ enviou:
Identidade Visual: Logo centralizado e linha divis√≥ria vermelha.
Organiza√ß√£o: Se√ß√µes claras de Detalhamento por Ambiente, Sum√°rio de Investimento e Condi√ß√µes Comerciais.
Eleg√¢ncia: Fontes e espa√ßamentos otimizados para uma leitura limpa.
Tamb√©m estou reenviando o arquivo index_updated.html com todas as melhorias mobile e este novo gerador de PDF integrado.
O que achou do novo visual? Se estiver tudo certo, o app est√° pronto para ser usado pelo Jo√£o!
Exemplo_Nova_Proposta_FiftyPlus.pdf
PDF ¬∑ 2.41 KB
index_updated.html
C√≥digo ¬∑ 76.85 KB
Ver todos os arquivos nesta tarefa
Tarefa conclu√≠da
Como foi este resultado?
Sugest√µes de acompanhamento



index_updated.html
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Fifty+ | Propostas para Marceneiros</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --red: #D42B2B;
  --red-dark: #AA2020;
  --red-light: #FFF0F0;
  --bg: #F2F2F7;
  --surface: #FFFFFF;
  --surface2: #F8F8F8;
  --border: #E5E5EA;
  --text: #1C1C1E;
  --text2: #48484A;
  --text3: #8E8E93;
  --green: #34C759;
  --green-dark: #248A3D;
  --green-bg: #F0FFF4;
  --radius: 13px;
  --nav-h: 56px;
  --tab-h: 60px;
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
html { height: 100%; }
body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg); color: var(--text);
  min-height: 100%; font-size: 16px;
  -webkit-font-smoothing: antialiased;
  overscroll-behavior: none;
}

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
#loginScreen {
  min-height: 100vh; min-height: 100dvh;
  display: flex; align-items: center; justify-content: center;
  background: linear-gradient(160deg, #1A1A1A 0%, #2D0808 100%);
  padding: 24px 20px;
  padding-top: calc(24px + var(--safe-top));
  padding-bottom: calc(24px + var(--safe-bottom));
}
.login-box {
  background: white; border-radius: 20px; padding: 36px 24px;
  width: 100%; max-width: 400px;
  box-shadow: 0 24px 80px rgba(0,0,0,0.5);
}
.login-logo { font-size: 32px; font-weight: 700; color: var(--red); text-align: center; margin-bottom: 6px; letter-spacing: -1px; }
.login-sub { text-align: center; font-size: 14px; color: var(--text3); margin-bottom: 32px; }
.login-label { font-size: 13px; font-weight: 600; color: var(--text2); display: block; margin-bottom: 6px; margin-top: 16px; }
.login-input {
  width: 100%; padding: 14px 16px; border: 1.5px solid var(--border); border-radius: 12px;
  font-family: 'Inter', sans-serif; font-size: 16px; outline: none; transition: border-color 0.15s;
  background: var(--surface2); color: var(--text);
}
.login-input:focus { border-color: var(--red); background: white; }
.login-btn {
  width: 100%; padding: 16px; background: var(--red); color: white; border: none;
  border-radius: 12px; font-family: 'Inter', sans-serif; font-size: 17px; font-weight: 600;
  cursor: pointer; margin-top: 22px; min-height: 54px; transition: background 0.15s; -webkit-appearance: none;
}
.login-btn:active { background: var(--red-dark); transform: scale(0.98); }
.login-btn:disabled { opacity: 0.5; }
.login-err { background: #FFF0F0; border: 1px solid #FCA5A5; color: var(--red); font-size: 14px; padding: 12px 14px; border-radius: 10px; margin-top: 14px; display: none; line-height: 1.4; }
.login-forgot { text-align: center; margin-top: 16px; font-size: 14px; color: var(--text3); padding: 10px; min-height: 44px; display: flex; align-items: center; justify-content: center; }
.login-switch a { color: var(--red); font-weight: 600; cursor: pointer; text-decoration: none; }

/* ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ */
#appScreen { display: none; min-height: 100vh; min-height: 100dvh; }

.topbar {
  background: var(--surface); border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 16px;
  height: calc(var(--nav-h) + var(--safe-top));
  padding-top: var(--safe-top);
  position: sticky; top: 0; z-index: 100;
}
.topbar-logo { font-size: 22px; font-weight: 700; color: var(--red); letter-spacing: -0.5px; }
.topbar-right { display: flex; align-items: center; gap: 10px; }

/* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
#appScreen { display: none; }
.nav-avatar {
  width: 34px; height: 34px; border-radius: 50%; background: var(--red);
  color: white; display: flex; align-items: center; justify-content: center;
  font-size: 14px; font-weight: 700;
}
.btn-logout {
  font-size: 14px; color: var(--text3); cursor: pointer; padding: 8px 12px;
  border-radius: 8px; transition: all 0.15s; border: 1px solid var(--border); background: none;
  font-family: 'Inter', sans-serif; min-height: 36px;
}
.btn-logout:active { background: var(--bg); }

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.wrap { max-width: 640px; margin: 0 auto; padding: 16px 14px calc(var(--tab-h) + var(--safe-bottom) + 16px); }

/* ‚îÄ‚îÄ BOTTOM TABBAR ‚îÄ‚îÄ */
.tabbar {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(255,255,255,0.95);
  backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
  border-top: 1px solid var(--border); display: flex;
  height: calc(var(--tab-h) + var(--safe-bottom));
  padding-bottom: var(--safe-bottom); z-index: 100;
}
.tab-btn {
  flex: 1; display: flex; flex-direction: column; align-items: center;
  justify-content: center; gap: 3px; border: none; background: none;
  cursor: pointer; font-family: 'Inter', sans-serif; padding: 8px 4px 4px;
  color: var(--text3); min-height: var(--tab-h);
}
.tab-btn.active { color: var(--red); }
.tab-icon { font-size: 22px; line-height: 1; }
.tab-label { font-size: 10px; font-weight: 600; letter-spacing: 0.2px; }
.page { display: none; }
.page.active { display: block; }
.sec-head { margin-bottom: 18px; }
.sec-head h1 { font-size: 20px; font-weight: 700; margin-bottom: 3px; }
.sec-head p { font-size: 13px; color: var(--text2); }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 16px; margin-bottom: 10px; }
.card-head { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; color: var(--red); margin-bottom: 12px; }

/* ‚îÄ‚îÄ FORM ‚îÄ‚îÄ */
.field { margin-bottom: 14px; }
.field:last-child { margin-bottom: 0; }
label { display: block; font-size: 13px; font-weight: 600; color: var(--text2); margin-bottom: 6px; }
input, select, textarea {
  width: 100%; padding: 13px 14px; border: 1.5px solid var(--border); border-radius: 10px;
  font-family: 'Inter', sans-serif; font-size: 16px; color: var(--text);
  background: var(--surface2); transition: border-color 0.15s; outline: none;
  -webkit-appearance: none; min-height: 50px;
}
input:focus, select:focus, textarea:focus { border-color: var(--red); background: white; box-shadow: 0 0 0 3px rgba(212,43,43,0.08); }
input::placeholder, textarea::placeholder { color: var(--text3); }
textarea { min-height: auto; resize: none; }
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

/* ‚îÄ‚îÄ LOGO UPLOAD ‚îÄ‚îÄ */
.logo-area { border: 2px dashed var(--border); border-radius: 10px; padding: 20px; text-align: center; cursor: pointer; background: var(--surface2); position: relative; min-height: 76px; }
.logo-area img { max-height: 60px; max-width: 160px; object-fit: contain; }
.logo-area .placeholder { font-size: 13px; color: var(--text3); }
.logo-area .placeholder span { display: block; font-size: 24px; margin-bottom: 4px; }
#logoInput { position: absolute; inset: 0; opacity: 0; cursor: pointer; }

/* ‚îÄ‚îÄ CHIPS ‚îÄ‚îÄ */
.chips { display: flex; flex-wrap: wrap; gap: 8px; }
.chip { border: 1.5px solid var(--border); border-radius: 20px; padding: 9px 16px; font-size: 14px; font-weight: 500; cursor: pointer; background: var(--surface2); color: var(--text2); transition: all 0.15s; user-select: none; min-height: 42px; display: flex; align-items: center; }
.chip:active { transform: scale(0.95); box-shadow: 0 2px 8px rgba(212,43,43,0.15); }
.chip.on { border-color: var(--red); background: var(--red-light); color: var(--red); font-weight: 600; }

/* ‚îÄ‚îÄ MOVEL GRID ‚îÄ‚îÄ */
.movel-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.movel-card { border: 1.5px solid var(--border); border-radius: 12px; padding: 14px 6px; cursor: pointer; text-align: center; background: var(--surface2); transition: all 0.15s; user-select: none; min-height: 72px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.movel-card:active { transform: scale(0.95); box-shadow: 0 2px 8px rgba(212,43,43,0.15); }
.movel-card.on { border-color: var(--red); background: var(--red-light); }
.movel-card .mi { font-size: 26px; margin-bottom: 5px; }
.movel-card .ml { font-size: 11px; font-weight: 600; color: var(--text2); line-height: 1.2; }
.movel-card.on .ml { color: var(--red); }

/* ‚îÄ‚îÄ MEDIDAS ‚îÄ‚îÄ */
.medida-item { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 12px; margin-bottom: 8px; }
.medida-item input { flex: none; padding: 10px 8px; font-size: 15px; min-height: 44px; }
.medida-dims { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 6px; margin-top: 8px; align-items: end; }
.dim-wrap { display: flex; flex-direction: column; gap: 4px; }
.dim-wrap label { font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text3); margin: 0; }
.medida-item .mi-label { font-size: 10px; color: var(--text3); white-space: nowrap; font-weight: 600; }
.btn-add-medida { display: flex; align-items: center; gap: 8px; justify-content: center; width: 100%; padding: 14px; border: 2px dashed var(--border); border-radius: 10px; background: none; font-family: 'Inter', sans-serif; font-size: 15px; font-weight: 600; color: var(--text3); cursor: pointer; margin-top: 6px; min-height: 52px; transition: all 0.15s; }
.btn-add-medida:active { border-color: var(--red); color: var(--red); }
.btn-rm-medida { width: 38px; min-height: 44px; border-radius: 8px; border: 1px solid #FCA5A5; background: #FFF0F0; color: #EF4444; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

/* ‚îÄ‚îÄ PGTO ‚îÄ‚îÄ */
.pgto-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.pgto-card { border: 1.5px solid var(--border); border-radius: 10px; padding: 12px 6px; cursor: pointer; background: var(--surface2); transition: all 0.15s; user-select: none; text-align: center; min-height: 62px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.pgto-card:active { transform: scale(0.95); box-shadow: 0 2px 8px rgba(212,43,43,0.15); }
.pgto-card.on { border-color: var(--red); background: var(--red-light); }
.pgto-card .pi { font-size: 20px; margin-bottom: 4px; }
.pgto-card .pl { font-size: 11px; font-weight: 600; color: var(--text2); }
.pgto-card.on .pl { color: var(--red); }

/* ‚îÄ‚îÄ STEPS ‚îÄ‚îÄ */
.steps-bar { display: flex; gap: 2px; align-items: center; margin-bottom: 16px; padding: 12px 14px; background: white; border-radius: var(--radius); border: 1px solid var(--border); overflow-x: auto; }
.step-dot { display: flex; align-items: center; gap: 4px; font-size: 11px; font-weight: 600; color: var(--text3); transition: all 0.15s; white-space: nowrap; cursor: pointer; }
.step-dot.active { color: var(--red); }
.step-dot.done { color: var(--green); }
.step-dot .sd { width: 22px; height: 22px; border-radius: 50%; background: var(--border); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }
.step-dot.active .sd { background: var(--red); color: white; }
.step-dot.done .sd { background: var(--green); color: white; }
.step-line { flex: 1; min-width: 10px; height: 1px; background: var(--border); }

/* ‚îÄ‚îÄ BTNS ‚îÄ‚îÄ */
.btn { display: flex; align-items: center; justify-content: center; gap: 7px; width: 100%; padding: 16px; border-radius: 12px; font-family: 'Inter', sans-serif; font-size: 16px; font-weight: 600; cursor: pointer; border: none; transition: all 0.15s; min-height: 54px; -webkit-appearance: none; position: relative; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none !important; }
.btn:active:not(:disabled) { transform: scale(0.97); }
.btn-primary { background: var(--red); color: white; }
.btn-primary:active:not(:disabled) { background: var(--red-dark); }
.btn-outline { background: var(--surface); color: var(--text2); border: 1.5px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.06); }
.btn-outline:active { background: var(--bg); }
.btn-green { background: #16A34A; color: white; }
.btn-green:active { background: #15803D; }
.btn-whatsapp { background: #25D366; color: white; }
.btn-whatsapp:active { background: #1DBB5B; }
.btn-row { display: flex; gap: 10px; margin-top: 8px; }
.btn-row .btn { flex: 1; }

/* ‚îÄ‚îÄ FOTO ‚îÄ‚îÄ */
.foto-section { margin-bottom: 16px; }
.foto-placeholder { background: var(--surface2); border: 2px dashed var(--border); border-radius: 10px; padding: 24px; text-align: center; color: var(--text3); font-size: 13px; }
.foto-placeholder span { display: block; font-size: 28px; margin-bottom: 6px; }
#fotoGrid { display: none; flex-wrap: wrap; gap: 8px; }
.foto-thumb { width: 72px; height: 72px; object-fit: cover; border-radius: 8px; border: 1px solid var(--border); cursor: pointer; transition: all 0.15s; }
.foto-thumb:active { transform: scale(0.95); }
.foto-add-more { width: 72px; height: 72px; border: 2px dashed var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--text3); cursor: pointer; transition: all 0.15s; background: var(--surface2); }
.foto-add-more:active { border-color: var(--red); color: var(--red); }
#fotosInput { display: none; }

/* ‚îÄ‚îÄ PREVIEW ‚îÄ‚îÄ */
.preview-box { background: white; border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden; }
.preview-header { background: var(--surface2); padding: 20px 16px; display: flex; justify-content: space-between; align-items: flex-start; }
.preview-header h2 { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
.preview-header p { font-size: 13px; color: var(--text3); }
.preview-logo-box { width: 80px; height: 60px; background: white; border-radius: 8px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; }
.logo-text { font-size: 12px; font-weight: 700; color: var(--red); text-align: center; }
.preview-body { padding: 20px 16px; }
.pv-section { margin-bottom: 16px; }
.pv-section h3 { font-size: 13px; font-weight: 700; color: var(--red); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
.pv-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border); font-size: 13px; }
.pv-row:last-child { border-bottom: none; }
.pk { color: var(--text3); font-weight: 500; }
.pv { color: var(--text); font-weight: 600; }
.pgto-pill { display: inline-block; background: var(--red-light); color: var(--red); padding: 6px 12px; border-radius: 16px; font-size: 12px; font-weight: 600; margin-right: 6px; margin-bottom: 6px; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
  position: fixed; bottom: calc(var(--tab-h) + var(--safe-bottom) + 16px); left: 16px; right: 16px;
  background: var(--text); color: white; padding: 14px 16px; border-radius: 10px;
  font-size: 14px; font-weight: 500; z-index: 200; opacity: 0; transition: opacity 0.3s;
  max-width: 300px; margin: 0 auto;
}
#toast.show { opacity: 1; }

/* ‚îÄ‚îÄ MODAL DELETE ‚îÄ‚îÄ */
#modalDelete {
  display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 300;
  align-items: center; justify-content: center;
}
#modalDelete.show { display: flex; }
.modal-content { background: white; border-radius: 16px; padding: 24px; max-width: 300px; text-align: center; }
.modal-content h2 { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
.modal-content p { font-size: 13px; color: var(--text3); margin-bottom: 20px; }
.modal-btns { display: flex; gap: 10px; }
.modal-btns button { flex: 1; padding: 12px; border-radius: 10px; border: none; font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; min-height: 44px; }
.modal-btns .btn-cancel { background: var(--border); color: var(--text); }
.modal-btns .btn-delete { background: #EF4444; color: white; }

/* ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ */
.spinner {
  display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ LOADING STATE ‚îÄ‚îÄ */
.btn.loading { pointer-events: none; }
.btn.loading .btn-text { opacity: 0; }
.btn.loading .btn-spinner { display: inline-block; }
.btn-spinner { display: none; }

/* ‚îÄ‚îÄ SUCCESS CHECK ‚îÄ‚îÄ */
.btn.success { background: var(--green); }
.btn.success .btn-text { opacity: 0; }
.btn.success .btn-check { display: inline-block; }
.btn-check { display: none; }

/* ‚îÄ‚îÄ PROPOSTAS LIST ‚îÄ‚îÄ */
.proposta-item { background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
.proposta-info { flex: 1; }
.proposta-info h3 { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
.proposta-info p { font-size: 12px; color: var(--text3); }
.proposta-status { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
.proposta-status.ativa { background: var(--green-bg); color: var(--green-dark); }
.proposta-status.enviada { background: #FEF3C7; color: #92400E; }
.proposta-status.fechada { background: #E0E7FF; color: #3730A3; }
.proposta-actions { display: flex; gap: 8px; }
.proposta-actions button { padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface2); color: var(--text2); font-size: 12px; font-weight: 600; cursor: pointer; min-height: 36px; }
.proposta-actions button:active { background: var(--border); }

/* ‚îÄ‚îÄ SEARCH ‚îÄ‚îÄ */
.search-box { margin-bottom: 16px; }
.search-box input { width: 100%; }

/* ‚îÄ‚îÄ UTILITY ‚îÄ‚îÄ */
.text-center { text-align: center; }
.mt { margin-top: 16px; }
.mb { margin-bottom: 16px; }
.flex-between { display: flex; justify-content: space-between; align-items: center; }

</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">Fifty+</div>
    <div class="login-sub">Propostas para Marceneiros</div>
    <div class="login-label">Email</div>
    <input type="email" id="loginEmail" class="login-input" placeholder="seu@email.com" autocomplete="email">
    <div class="login-label">Senha</div>
    <input type="password" id="loginPassword" class="login-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
    <button class="login-btn" onclick="fazerLogin()">Entrar</button>
    <div class="login-err" id="loginErr"></div>
    <div class="login-forgot">
      <span>N√£o tem conta? <a onclick="toggleAuthMode()">Criar conta</a></span>
    </div>
  </div>
</div>

<!-- APP -->
<div id="appScreen">
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-logo">Fifty+</div>
    <div class="topbar-right">
      <div class="nav-avatar" id="navAvatar">‚Äî</div>
      <button class="btn-logout" onclick="fazerLogout()">Sair</button>
    </div>
  </div>

  <!-- PAGES -->
  <div class="wrap">
    <!-- PERFIL -->
    <div class="page active" id="page-perfil">
      <div class="sec-head">
        <h1>Seu Perfil</h1>
        <p>Informa√ß√µes da sua marcenaria</p>
      </div>
      <div class="card">
        <div class="card-head">Logo</div>
        <div class="logo-area" onclick="document.getElementById('logoInput').click()">
          <img id="logoPreview" style="display:none;">
          <div class="placeholder" id="logoPlaceholder"><span>üì∑</span>Toque para adicionar logo</div>
        </div>
        <input type="file" id="logoInput" accept="image/*" onchange="carregarLogo(this)">
      </div>
      <div class="card">
        <div class="card-head">Dados B√°sicos</div>
        <div class="field"><label>Nome da Marcenaria</label><input type="text" id="p-nome" placeholder="Ex: Marcenaria Jo√£o"></div>
        <div class="field"><label>Cidade</label><input type="text" id="p-cidade" placeholder="Ex: S√£o Paulo, SP"></div>
        <div class="field"><label>WhatsApp</label><input type="tel" id="p-wpp" placeholder="(11) 99999-9999" inputmode="tel" oninput="formatarWhatsApp(this)"></div>
        <div class="field"><label>Instagram (opcional)</label><input type="text" id="p-insta" placeholder="@seu_insta"></div>
      </div>
      <div class="card">
        <div class="card-head">Prazos e Validade</div>
        <div class="g2">
          <div class="field"><label>Prazo M√≠nimo (dias)</label><input type="number" id="p-prazo-min" placeholder="7" min="1" inputmode="numeric"></div>
          <div class="field"><label>Prazo M√°ximo (dias)</label><input type="number" id="p-prazo-max" placeholder="60" min="1" inputmode="numeric"></div>
        </div>
        <div class="field"><label>Validade da Proposta (dias)</label><input type="number" id="p-validade" placeholder="15" min="1" inputmode="numeric"></div>
      </div>
      <div class="card">
        <div class="card-head">Rodap√© das Propostas</div>
        <div class="field"><label>Texto do Rodap√©</label><textarea id="p-rodape" rows="2" placeholder="Ex: Agradecemos a oportunidade..."></textarea></div>
      </div>
      <button class="btn btn-primary" onclick="salvarPerfil()" style="margin-top: 16px;">üíæ Salvar Perfil</button>
    </div>

    <!-- OR√áAMENTO -->
    <div class="page" id="page-orcamento">
      <div class="sec-head">
        <h1 id="orcTitle">Nova Proposta</h1>
        <p>Preencha os 5 passos abaixo</p>
      </div>

      <!-- STEPS BAR -->
      <div class="steps-bar">
        <div class="step-dot active" onclick="goStep(1)"><div class="sd">1</div>Cliente</div>
        <div class="step-line"></div>
        <div class="step-dot" onclick="goStep(2)"><div class="sd">2</div>M√≥vel</div>
        <div class="step-line"></div>
        <div class="step-dot" onclick="goStep(3)"><div class="sd">3</div>Medidas</div>
        <div class="step-line"></div>
        <div class="step-dot" onclick="goStep(4)"><div class="sd">4</div>Valores</div>
        <div class="step-line"></div>
        <div class="step-dot" onclick="goStep(5)"><div class="sd">5</div>Pagto</div>
      </div>

      <!-- STEP 1 -->
      <div class="step-page" id="step1">
        <div class="card">
          <div class="card-head">Dados do Cliente</div>
          <div class="field"><label>Nome do Cliente</label><input type="text" id="c-nome" placeholder="Nome completo" autocomplete="name"></div>
          <div class="field"><label>WhatsApp</label><input type="tel" id="c-wpp" placeholder="(11) 99999-9999" inputmode="tel" oninput="formatarWhatsApp(this)"></div>
          <div class="field"><label>Endere√ßo</label><input type="text" id="c-end" placeholder="Rua, n√∫mero, complemento"></div>
          <div class="field"><label>Refer√™ncia (opcional)</label><input type="text" id="c-ref" placeholder="Pr√≥ximo a..."></div>
        </div>
        <div class="btn-row">
          <button class="btn btn-primary" onclick="goStep(2)">Pr√≥ximo ‚Üí</button>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="step-page" id="step2" style="display:none">
        <div class="card">
          <div class="card-head">Tipo de M√≥vel</div>
          <div class="movel-grid" id="movelGrid">
            <div class="movel-card on" onclick="selectMovel(this, 'Cozinha Planejada')"><div class="mi">üç≥</div><div class="ml">Cozinha</div></div>
            <div class="movel-card" onclick="selectMovel(this, 'Guarda-Roupa')"><div class="mi">üëï</div><div class="ml">Guarda-Roupa</div></div>
            <div class="movel-card" onclick="selectMovel(this, 'Home Office')"><div class="mi">üíª</div><div class="ml">Home Office</div></div>
            <div class="movel-card" onclick="selectMovel(this, 'Closet')"><div class="mi">üëó</div><div class="ml">Closet</div></div>
            <div class="movel-card" onclick="selectMovel(this, 'Banheiro')"><div class="mi">üöø</div><div class="ml">Banheiro</div></div>
            <div class="movel-card" onclick="selectMovel(this, 'Rack / Painel TV')"><div class="mi">üì∫</div><div class="ml">Rack/Painel</div></div>
            <div class="movel-card" onclick="selectMovel(this, 'Quarto Infantil')"><div class="mi">üß∏</div><div class="ml">Infantil</div></div>
            <div class="movel-card" onclick="selectMovel(this, '√Årea de Servi√ßo')"><div class="mi">üß∫</div><div class="ml">√Årea Servi√ßo</div></div>
            <div class="movel-card" onclick="selectMovel(this, 'M√≥vel Sob Medida')"><div class="mi">üìê</div><div class="ml">Sob Medida</div></div>
          </div>
        </div>
        <div class="card">
          <div class="card-head">Material (Chapa)</div>
          <div class="chips" id="chapas">
            <div class="chip on" onclick="toggleChip(this, 'chapas')">MDF Branco</div>
            <div class="chip" onclick="toggleChip(this, 'chapas')">MDF Preto</div>
            <div class="chip" onclick="toggleChip(this, 'chapas')">MDF Cinza</div>
            <div class="chip" onclick="toggleChip(this, 'chapas')">Madeira Maci√ßa</div>
            <div class="chip" onclick="toggleChip(this, 'chapas')">Melamina</div>
            <div class="chip" onclick="toggleChip(this, 'chapas')">Vidro</div>
          </div>
        </div>
        <div class="card">
          <div class="card-head">Acabamento</div>
          <div class="chips" id="acabs">
            <div class="chip on" onclick="toggleChip(this, 'acabs')">Pintura</div>
            <div class="chip" onclick="toggleChip(this, 'acabs')">Verniz</div>
            <div class="chip" onclick="toggleChip(this, 'acabs')">Laminado</div>
            <div class="chip" onclick="toggleChip(this, 'acabs')">Envernizado</div>
            <div class="chip" onclick="toggleChip(this, 'acabs')">Natural</div>
          </div>
        </div>
        <div class="card">
          <div class="card-head">Ferragens</div>
          <div class="chips" id="ferragens">
            <div class="chip on" onclick="toggleChip(this, 'ferragens')">Padr√£o</div>
            <div class="chip" onclick="toggleChip(this, 'ferragens')">Premium</div>
            <div class="chip" onclick="toggleChip(this, 'ferragens')">Luxo</div>
            <div class="chip" onclick="toggleChip(this, 'ferragens')">Sem Ferragens</div>
          </div>
        </div>
        <div class="card">
          <div class="card-head">Detalhes (opcional)</div>
          <textarea id="m-detalhes" rows="2" placeholder="Ex: Espelho, vidro temperado, detalhes especiais..."></textarea>
        </div>
        <div class="card">
          <div class="card-head">Fotos de Refer√™ncia</div>
          <div class="foto-section">
            <div class="foto-placeholder" id="fotoPlaceholder" onclick="document.getElementById('fotosInput').click()"><span>üì∏</span>Toque para adicionar fotos</div>
            <div id="fotoGrid"></div>
            <input type="file" id="fotosInput" multiple accept="image/*" onchange="loadFotos(this)">
          </div>
        </div>
        <div class="btn-row">
          <button class="btn btn-outline" onclick="goStep(1)">‚Üê Voltar</button>
          <button class="btn btn-primary" onclick="goStep(3)">Pr√≥ximo ‚Üí</button>
        </div>
      </div>

      <!-- STEP 3 -->
      <div class="step-page" id="step3" style="display:none">
        <div class="card">
          <div class="card-head">Medidas das Pe√ßas</div>
          <div id="medidasList"></div>
          <button class="btn-add-medida" onclick="addMedida()">+ Adicionar Medida</button>
        </div>
        <div class="card">
          <div class="card-head">Prazos</div>
          <div class="field"><label>Data de In√≠cio Prevista</label><input type="date" id="m-inicio"></div>
          <div class="field"><label>Data de Entrega Prevista</label><input type="date" id="m-entrega"></div>
          <div class="field"><label>Observa√ß√µes sobre Prazo (opcional)</label><textarea id="m-prazo-obs" rows="2" placeholder="Ex: Sujeito a confirma√ß√£o de materiais..."></textarea></div>
        </div>
        <div class="btn-row">
          <button class="btn btn-outline" onclick="goStep(2)">‚Üê Voltar</button>
          <button class="btn btn-primary" onclick="goStep(4)">Pr√≥ximo ‚Üí</button>
        </div>
      </div>

      <!-- STEP 4 -->
      <div class="step-page" id="step4" style="display:none">
        <div class="card">
          <div class="card-head">Composi√ß√£o de Custos</div>
          <div class="field"><label>Material (R$)</label><input type="number" id="v-mat" placeholder="0.00" min="0" step="0.01" inputmode="decimal" oninput="calcTotal()"></div>
          <div class="field"><label>M√£o de Obra (R$)</label><input type="number" id="v-mao" placeholder="0.00" min="0" step="0.01" inputmode="decimal" oninput="calcTotal()"></div>
          <div class="field"><label>Ferragens (R$)</label><input type="number" id="v-ferr" placeholder="0.00" min="0" step="0.01" inputmode="decimal" oninput="calcTotal()"></div>
          <div class="field"><label>Outros (R$)</label><input type="number" id="v-outros" placeholder="0.00" min="0" step="0.01" inputmode="decimal" oninput="calcTotal()"></div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:14px;">
            <label style="margin:0;white-space:nowrap;">Margem (%)</label>
            <input type="number" id="v-margem" placeholder="30" min="0" max="500" step="1" value="30" inputmode="numeric" oninput="calcTotal()" style="width:85px;flex:none;">
            <div style="flex:1;background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 12px;font-size:14px;color:var(--text3);">
              Margem: <strong id="v-margem-val" style="color:var(--red);">R$ 0,00</strong>
            </div>
          </div>
        </div>
        <div class="card">
          <div style="border-top:1px solid var(--border);padding-top:12px;margin-top:12px;">
            <div style="display:flex;justify-content:space-between;margin-bottom:6px;">
              <span style="font-size:12px;font-weight:600;color:var(--text3);">Subtotal</span>
              <span id="v-subtotal-preview" style="font-size:14px;color:var(--text2);font-weight:600;">R$ 0,00</span>
            </div>
            <div style="display:flex;justify-content:space-between;background:var(--red-light);border-radius:8px;padding:12px 14px;">
              <span style="font-size:14px;font-weight:700;color:var(--red);">TOTAL DO CLIENTE</span>
              <span id="v-total-preview" style="font-size:20px;font-weight:700;color:var(--red);">R$ 0,00</span>
            </div>
          </div>
        </div>
        <div class="card">
          <div class="card-head">Condi√ß√µes e Garantia</div>
          <div class="field"><label>Garantia</label><input type="text" id="v-garantia" placeholder="Ex: 1 ano em ferragens, 6 meses em acabamento"></div>
          <div class="field"><label>O que est√° incluso</label><textarea id="v-incluso" rows="2" placeholder="Projeto, material, m√£o de obra e instala√ß√£o..."></textarea></div>
          <div class="field"><label>O que N√ÉO est√° incluso</label><textarea id="v-excluso" rows="2" placeholder="Eletrodom√©sticos, ilumina√ß√£o..."></textarea></div>
        </div>
        <div class="btn-row">
          <button class="btn btn-outline" onclick="goStep(3)">‚Üê Voltar</button>
          <button class="btn btn-primary" onclick="goStep(5)">Pr√≥ximo ‚Üí</button>
        </div>
      </div>

      <!-- STEP 5 -->
      <div class="step-page" id="step5" style="display:none">
        <div class="card">
          <div class="card-head">Formas de Pagamento</div>
          <div class="pgto-grid">
            <div class="pgto-card on" onclick="togglePgto(this)"><div class="pi">üíµ</div><div class="pl">Dinheiro</div></div>
            <div class="pgto-card on" onclick="togglePgto(this)"><div class="pi">üì±</div><div class="pl">PIX</div></div>
            <div class="pgto-card" onclick="togglePgto(this)"><div class="pi">üí≥</div><div class="pl">Cart√£o Cr√©dito</div></div>
            <div class="pgto-card" onclick="togglePgto(this)"><div class="pi">üè¶</div><div class="pl">Transfer√™ncia</div></div>
            <div class="pgto-card" onclick="togglePgto(this)"><div class="pi">üìã</div><div class="pl">Cheque</div></div>
            <div class="pgto-card" onclick="togglePgto(this)"><div class="pi">ü§ù</div><div class="pl">Financiamento</div></div>
          </div>
          <div style="margin-top:12px;">
            <div class="field"><label>Condi√ß√£o de pagamento</label><input type="text" id="pg-condicao" placeholder="Ex: 50% na aprova√ß√£o + 50% na entrega"></div>
            <div class="field"><label>Chave PIX</label><input type="text" id="pg-pix" placeholder="CPF, telefone ou e-mail"></div>
          </div>
        </div>
        <div class="card">
          <div class="card-head">Observa√ß√µes Finais</div>
          <textarea id="obs-final" rows="3" placeholder="Informa√ß√µes adicionais para o cliente..."></textarea>
        </div>
        <button class="btn btn-green" id="btnSalvar" onclick="salvarProposta()">
          <span class="btn-text">üíæ Salvar e Gerar Proposta</span>
          <span class="btn-spinner"><div class="spinner"></div></span>
          <span class="btn-check">‚úÖ</span>
        </button>
      </div>
    </div>

    <!-- PREVIEW -->
    <div class="page" id="page-preview">
      <div class="sec-head">
        <h1>Proposta Gerada ‚úÖ</h1>
        <p>Revise, baixe o PDF ou envie pelo WhatsApp.</p>
      </div>
      <div class="preview-box" id="previewBox">
        <div class="preview-header">
          <div>
            <h2 id="pv-titulo">Proposta de Servi√ßo</h2>
            <p id="pv-num">N¬∫ 001</p>
            <p id="pv-validade-txt" style="opacity:0.6;margin-top:2px;font-size:11px;">V√°lido por 15 dias</p>
          </div>
          <div class="preview-logo-box" id="pvLogoBox">
            <div class="logo-text" id="pvLogoText">‚Äî</div>
          </div>
        </div>
        <div class="preview-body">
          <div class="pv-section">
            <h3>Marceneiro</h3>
            <div class="pv-row"><span class="pk">Nome</span><span class="pv" id="pv-marc-nome">‚Äî</span></div>
            <div class="pv-row"><span class="pk">WhatsApp</span><span class="pv" id="pv-marc-wpp">‚Äî</span></div>
            <div class="pv-row"><span class="pk">Cidade</span><span class="pv" id="pv-marc-cidade">‚Äî</span></div>
          </div>
          <div class="pv-section">
            <h3>Cliente</h3>
            <div class="pv-row"><span class="pk">Nome</span><span class="pv" id="pv-c-nome">‚Äî</span></div>
            <div class="pv-row"><span class="pk">WhatsApp</span><span class="pv" id="pv-c-wpp">‚Äî</span></div>
            <div class="pv-row"><span class="pk">Endere√ßo</span><span class="pv" id="pv-c-end">‚Äî</span></div>
            <div class="pv-row" id="pv-c-ref-row"><span class="pk">Refer√™ncia</span><span class="pv" id="pv-c-ref">‚Äî</span></div>
          </div>
          <div class="pv-section">
            <h3>Servi√ßo</h3>
            <div class="pv-row"><span class="pk">Tipo</span><span class="pv" id="pv-tipo">‚Äî</span></div>
            <div class="pv-row"><span class="pk">Material</span><span class="pv" id="pv-mat">‚Äî</span></div>
            <div class="pv-row"><span class="pk">Acabamento</span><span class="pv" id="pv-acab">‚Äî</span></div>
            <div class="pv-row"><span class="pk">Ferragens</span><span class="pv" id="pv-ferr">‚Äî</span></div>
            <div class="pv-row" id="pv-det-row"><span class="pk">Detalhes</span><span class="pv" id="pv-det">‚Äî</span></div>
          </div>
          <div class="pv-section" id="pv-med-section" style="display:none;">
            <h3>Medidas</h3>
            <table style="width:100%;font-size:12px;">
              <tbody id="pv-med-body"></tbody>
            </table>
          </div>
          <div class="pv-section">
            <h3>Prazos</h3>
            <div class="pv-row"><span class="pk">In√≠cio</span><span class="pv" id="pv-inicio">‚Äî</span></div>
            <div class="pv-row"><span class="pk">Entrega</span><span class="pv" id="pv-entrega">‚Äî</span></div>
            <div class="pv-row" id="pv-prazo-obs-row"><span class="pk">Observa√ß√µes</span><span class="pv" id="pv-prazo-obs">‚Äî</span></div>
          </div>
          <div class="pv-section" style="background:var(--red-light);padding:12px;border-radius:8px;margin:0;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <span style="font-size:12px;color:var(--text3);">TOTAL:</span>
              <span id="pv-total" style="font-size:20px;font-weight:700;color:var(--red);">R$ 0,00</span>
            </div>
          </div>
          <div class="pv-section">
            <h3>Pagamento</h3>
            <div id="pv-pgto-pills" style="margin-bottom:8px;"></div>
            <div class="pv-row" id="pv-condicao-row"><span class="pk">Condi√ß√£o</span><span class="pv" id="pv-condicao">‚Äî</span></div>
            <div class="pv-row" id="pv-pix-row"><span class="pk">PIX</span><span class="pv" id="pv-pix">‚Äî</span></div>
          </div>
          <div class="pv-section">
            <h3>Garantia e Condi√ß√µes</h3>
            <div class="pv-row"><span class="pk">Garantia</span><span class="pv" id="pv-garantia">‚Äî</span></div>
            <div class="pv-row"><span class="pk">Incluso</span><span class="pv" id="pv-incluso">‚Äî</span></div>
            <div class="pv-row"><span class="pk">N√£o Incluso</span><span class="pv" id="pv-excluso">‚Äî</span></div>
          </div>
          <div class="pv-section" id="pv-fotos-section" style="display:none;"></div>
          <div class="pv-section" id="pv-obs-section" style="display:none;">
            <h3>Observa√ß√µes</h3>
            <p id="pv-obs" style="font-size:12px;color:var(--text2);margin:0;"></p>
          </div>
          <div class="pv-section" id="pv-rodape-section" style="display:none;">
            <p id="pv-rodape" style="font-size:11px;color:var(--text3);margin:0;font-style:italic;"></p>
          </div>
        </div>
      </div>
      <div class="btn-row" style="margin-top:16px;">
        <button class="btn btn-outline" onclick="novaPropostaForm()">‚Üê Nova Proposta</button>
        <button class="btn btn-primary" onclick="gerarPDF()">üì• Baixar PDF</button>
        <button class="btn btn-whatsapp" onclick="enviarWhatsApp()">üì± WhatsApp</button>
      </div>
    </div>

    <!-- PROPOSTAS -->
    <div class="page" id="page-propostas">
      <div class="sec-head">
        <h1>Minhas Propostas</h1>
        <p>Hist√≥rico e gerenciamento</p>
      </div>
      <div class="search-box">
        <input type="text" id="searchPropostas" placeholder="üîç Buscar por cliente..." oninput="filtrarPropostas()">
      </div>
      <div id="propostasContainer"></div>
    </div>
  </div>

  <!-- TABBAR -->
  <div class="tabbar">
    <button class="tab-btn active" onclick="showPage('perfil')"><div class="tab-icon">üë§</div><div class="tab-label">Perfil</div></button>
    <button class="tab-btn" onclick="showPage('orcamento')"><div class="tab-icon">üìù</div><div class="tab-label">Or√ßamento</div></button>
    <button class="tab-btn" onclick="showPage('propostas')"><div class="tab-icon">üìã</div><div class="tab-label">Propostas</div></button>
  </div>

  <!-- TOAST -->
  <div id="toast"></div>

  <!-- MODAL DELETE -->
  <div id="modalDelete">
    <div class="modal-content">
      <h2>Excluir Proposta?</h2>
      <p>Esta a√ß√£o n√£o pode ser desfeita.</p>
      <div class="modal-btns">
        <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
        <button class="btn-delete" onclick="confirmarDelete()">Excluir</button>
      </div>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUPABASE CONFIG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SUPABASE_URL = 'https://toibffvqhvpflhakhyls.supabase.co';
const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRvaWJmZnZxaHZwZmxoYWtoeWxzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MTgyMDEsImV4cCI6MjA4NzA5NDIwMX0.G8ffvH1ImjfvGFSP0dnCiXHZCfrpjqYvsa5FidfkGGM';
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let currentUser = null;
let currentProfile = {};
let currentPropostaData = {};
let allPropostas = [];
let logoData = null;
let fotosData = [];
let medidas = [];
let movelSelecionado = 'Cozinha Planejada';
let editingId = null;
let deleteTargetId = null;
let orcNumBase = 1;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function fazerLogin() {
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  const errEl = document.getElementById('loginErr');
  errEl.style.display = 'none';

  if (!email || !password) {
    errEl.textContent = 'Preencha email e senha';
    errEl.style.display = 'block';
    return;
  }

  try {
    const { data, error } = await sb.auth.signInWithPassword({ email, password });
    if (error) throw error;
    currentUser = data.user;
    await carregarPerfil();
    await carregarPropostas();
    mostrarApp();
  } catch (err) {
    errEl.textContent = err.message || 'Erro ao fazer login';
    errEl.style.display = 'block';
  }
}

async function fazerLogout() {
  await sb.auth.signOut();
  currentUser = null;
  currentProfile = {};
  logoData = null;
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('appScreen').style.display = 'none';
}

async function verificarAuth() {
  const { data } = await sb.auth.getSession();
  if (data.session) {
    currentUser = data.session.user;
    await carregarPerfil();
    await carregarPropostas();
    mostrarApp();
  }
}

function mostrarApp() {
  document.getElementById('loginScreen').style.display = 'none';
  document.getElementById('appScreen').style.display = 'block';
  document.getElementById('navAvatar').textContent = (currentProfile.nome || 'U').charAt(0).toUpperCase();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PERFIL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function carregarPerfil() {
  const { data, error } = await sb.from('profiles').select('*').eq('id', currentUser.id).single();
  if (error && error.code !== 'PGRST116') { toast('‚ùå Erro ao carregar perfil'); return; }
  if (data) {
    currentProfile = data;
    logoData = data.logo || null;
    preencherFormPerfil();
  } else {
    currentProfile = { id: currentUser.id, nome: '', cidade: '', wpp: '', validade: 15 };
  }
}

function preencherFormPerfil() {
  document.getElementById('p-nome').value = currentProfile.nome || '';
  document.getElementById('p-cidade').value = currentProfile.cidade || '';
  document.getElementById('p-wpp').value = currentProfile.wpp || '';
  document.getElementById('p-insta').value = currentProfile.insta || '';
  document.getElementById('p-prazo-min').value = currentProfile.prazo_min || '7';
  document.getElementById('p-prazo-max').value = currentProfile.prazo_max || '60';
  document.getElementById('p-validade').value = currentProfile.validade || '15';
  document.getElementById('p-rodape').value = currentProfile.rodape || '';
  if (logoData) {
    document.getElementById('logoPreview').src = logoData;
    document.getElementById('logoPreview').style.display = 'block';
    document.getElementById('logoPlaceholder').style.display = 'none';
  }
}

async function salvarPerfil() {
  const payload = {
    id: currentUser.id,
    nome: document.getElementById('p-nome').value,
    cidade: document.getElementById('p-cidade').value,
    wpp: document.getElementById('p-wpp').value,
    insta: document.getElementById('p-insta').value,
    prazo_min: parseInt(document.getElementById('p-prazo-min').value) || 7,
    prazo_max: parseInt(document.getElementById('p-prazo-max').value) || 60,
    validade: parseInt(document.getElementById('p-validade').value) || 15,
    rodape: document.getElementById('p-rodape').value,
    logo: logoData,
    updated_at: new Date().toISOString()
  };

  try {
    const { error } = await sb.from('profiles').upsert(payload);
    if (error) throw error;
    currentProfile = payload;
    toast('‚úÖ Perfil salvo com sucesso!');
  } catch (err) {
    toast('‚ùå Erro ao salvar: ' + err.message);
  }
}

function carregarLogo(input) {
  if (!input.files[0]) return;
  const reader = new FileReader();
  reader.onload = e => {
    logoData = e.target.result;
    document.getElementById('logoPreview').src = logoData;
    document.getElementById('logoPreview').style.display = 'block';
    document.getElementById('logoPlaceholder').style.display = 'none';
  };
  reader.readAsDataURL(input.files[0]);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// COMPRESS√ÉO DE FOTOS (MELHORIA MOBILE)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function comprimirImagem(file, callback, maxSize = 800000) {
  const reader = new FileReader();
  reader.onload = e => {
    const img = new Image();
    img.onload = () => {
      const canvas = document.createElement('canvas');
      let width = img.width;
      let height = img.height;
      
      // Redimensionar se muito grande
      if (width > 1200 || height > 1200) {
        const ratio = Math.min(1200 / width, 1200 / height);
        width = Math.round(width * ratio);
        height = Math.round(height * ratio);
      }
      
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(img, 0, 0, width, height);
      
      // Comprimir JPEG iterativamente
      let quality = 0.8;
      let dataUrl = canvas.toDataURL('image/jpeg', quality);
      while (dataUrl.length > maxSize && quality > 0.1) {
        quality -= 0.1;
        dataUrl = canvas.toDataURL('image/jpeg', quality);
      }
      
      callback(dataUrl);
    };
    img.src = e.target.result;
  };
  reader.readAsDataURL(file);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// M√ÅSCARAS DE INPUT (MELHORIA MOBILE)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function formatarWhatsApp(input) {
  let val = input.value.replace(/\D/g, '');
  if (val.length > 11) val = val.slice(0, 11);
  if (val.length === 11) {
    val = `(${val.slice(0, 2)}) ${val.slice(2, 7)}-${val.slice(7)}`;
  } else if (val.length > 6) {
    val = `(${val.slice(0, 2)}) ${val.slice(2, 7)}-${val.slice(7)}`;
  } else if (val.length > 2) {
    val = `(${val.slice(0, 2)}) ${val.slice(2)}`;
  }
  input.value = val;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FOTOS COM COMPRESS√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function loadFotos(input) {
  [...input.files].forEach(file => {
    comprimirImagem(file, dataUrl => {
      fotosData.push(dataUrl);
      renderFotoGrid();
      toast('‚úÖ Foto adicionada (comprimida)');
    });
  });
}

function renderFotoGrid() {
  const grid = document.getElementById('fotoGrid');
  const ph   = document.getElementById('fotoPlaceholder');
  if (fotosData.length > 0) {
    ph.style.display = 'none'; grid.style.display = 'flex';
    grid.innerHTML = fotosData.map((src,i) =>
      `<img src="${src}" class="foto-thumb" onclick="removeFoto(${i})" title="Toque para remover">`
    ).join('') + `<div class="foto-add-more" onclick="document.getElementById('fotosInput').click()">+</div>`;
  } else {
    ph.style.display = 'block'; grid.style.display = 'none';
  }
}

function removeFoto(idx) { fotosData.splice(idx,1); renderFotoGrid(); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OR√áAMENTO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function novaPropostaForm() {
  editingId = null;
  document.getElementById('orcTitle').textContent = 'Nova Proposta';
  document.getElementById('btnSalvar').textContent = 'üíæ Salvar e Gerar Proposta';
  ['c-nome','c-wpp','c-end','c-ref','m-detalhes','m-inicio','m-entrega','m-prazo-obs',
   'v-mat','v-mao','v-ferr','v-outros','v-garantia','v-incluso','v-excluso',
   'pg-condicao','pg-pix','obs-final'].forEach(id => set(id,''));
  set('v-margem','30');
  movelSelecionado = 'Cozinha Planejada';
  document.querySelectorAll('#movelGrid .movel-card').forEach((c,i) => c.classList.toggle('on', i===0));
  ['chapas','acabs','ferragens'].forEach(g => {
    document.querySelectorAll(`#${g} .chip`).forEach((c,i) => c.classList.toggle('on', i===0));
  });
  document.querySelectorAll('.pgto-card').forEach((c,i) => c.classList.toggle('on', i<2));
  medidas = []; fotosData = [];
  document.getElementById('medidasList').innerHTML = '';
  renderFotoGrid();
  calcTotal();
  goStep(1);
  showPage('orcamento');
}

async function salvarProposta() {
  const btn = document.getElementById('btnSalvar');
  btn.classList.add('loading');
  btn.disabled = true;

  try {
    const mat   = parseFloat(v('v-mat'))    || 0;
    const mao   = parseFloat(v('v-mao'))    || 0;
    const ferr  = parseFloat(v('v-ferr'))   || 0;
    const out   = parseFloat(v('v-outros')) || 0;
    const marg  = parseFloat(v('v-margem')) || 0;
    const sub   = mat + mao + ferr + out;
    const total = sub + sub * (marg / 100);

    const payload = {
      user_id: currentUser.id,
      numero: editingId ? (allPropostas.find(x=>x.id===editingId)?.numero || orcNumBase) : orcNumBase,
      cliente_nome: v('c-nome'),
      cliente_wpp: v('c-wpp'),
      cliente_end: v('c-end'),
      cliente_ref: v('c-ref'),
      tipo_movel: movelSelecionado,
      chapa: document.querySelector('#chapas .chip.on')?.textContent || '',
      acabamento: document.querySelector('#acabs .chip.on')?.textContent || '',
      ferragens: document.querySelector('#ferragens .chip.on')?.textContent || '',
      detalhes: v('m-detalhes'),
      medidas: medidas.map(id => ({
        nome: document.getElementById('mn-'+id)?.value||'',
        l: document.getElementById('ml-'+id)?.value||'',
        a: document.getElementById('ma-'+id)?.value||'',
        p: document.getElementById('mp-'+id)?.value||''
      })),
      fotos: fotosData,
      inicio: v('m-inicio'),
      entrega: v('m-entrega'),
      prazo_obs: v('m-prazo-obs'),
      v_mat: mat,
      v_mao: mao,
      v_ferr: ferr,
      v_outros: out,
      v_margem: marg,
      v_total: total,
      garantia: v('v-garantia'),
      incluso: v('v-incluso'),
      excluso: v('v-excluso'),
      pgto_formas: [...document.querySelectorAll('.pgto-card.on')].map(c => c.querySelector('.pl').textContent),
      pgto_condicao: v('pg-condicao'),
      pgto_pix: v('pg-pix'),
      obs_final: v('obs-final'),
      status: 'ativa',
      updated_at: new Date().toISOString()
    };

    let error;
    if (editingId) {
      ({ error } = await sb.from('propostas').update(payload).eq('id', editingId));
    } else {
      ({ error } = await sb.from('propostas').insert(payload));
    }

    if (error) throw new Error(error.message);

    // Mostrar sucesso com anima√ß√£o
    btn.classList.remove('loading');
    btn.classList.add('success');
    await new Promise(r => setTimeout(r, 1500));
    
    editingId = null;
    await carregarPropostas();
    montarPreview();
    showPage('preview');

  } catch (err) {
    toast('‚ùå Erro ao salvar: ' + (err.message || 'Tente novamente.'));
  } finally {
    btn.classList.remove('loading', 'success');
    btn.disabled = false;
    btn.textContent = 'üíæ Salvar e Gerar Proposta';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROPOSTAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function carregarPropostas() {
  const { data, error } = await sb.from('propostas').select('*').eq('user_id', currentUser.id).order('created_at', { ascending: false });
  if (error) { toast('‚ùå Erro ao carregar propostas'); return; }
  allPropostas = data || [];
  orcNumBase = (Math.max(...allPropostas.map(p => p.numero || 0), 0) + 1);
  renderizarPropostas();
}

function renderizarPropostas() {
  const container = document.getElementById('propostasContainer');
  if (allPropostas.length === 0) {
    container.innerHTML = '<div style="text-align:center;padding:40px 20px;color:var(--text3);"><p>Nenhuma proposta ainda</p><button class="btn btn-primary" onclick="novaPropostaForm()" style="margin-top:16px;">Criar Primeira Proposta</button></div>';
    return;
  }

  container.innerHTML = allPropostas.map(p => `
    <div class="proposta-item">
      <div class="proposta-info">
        <h3>${p.cliente_nome || 'Cliente'}</h3>
        <p>${p.tipo_movel} ‚Ä¢ ${fmt(p.v_total || 0)}</p>
        <p style="font-size:11px;color:var(--text3);">${new Date(p.created_at).toLocaleDateString('pt-BR')}</p>
      </div>
      <div style="display:flex;gap:8px;flex-direction:column;align-items:flex-end;">
        <span class="proposta-status ${p.status || 'ativa'}">${p.status === 'enviada' ? 'üì§ Enviada' : p.status === 'fechada' ? '‚úÖ Fechada' : 'üìù Ativa'}</span>
        <div class="proposta-actions">
          <button onclick="visualizarProposta('${p.id}')">üëÅ Ver</button>
          <button onclick="editarProposta('${p.id}')">‚úèÔ∏è Editar</button>
          <button onclick="deletarProposta('${p.id}')">üóë Deletar</button>
        </div>
      </div>
    </div>
  `).join('');
}

function filtrarPropostas() {
  const termo = document.getElementById('searchPropostas').value.toLowerCase();
  const filtradas = allPropostas.filter(p => (p.cliente_nome || '').toLowerCase().includes(termo));
  const container = document.getElementById('propostasContainer');
  container.innerHTML = filtradas.map(p => `
    <div class="proposta-item">
      <div class="proposta-info">
        <h3>${p.cliente_nome || 'Cliente'}</h3>
        <p>${p.tipo_movel} ‚Ä¢ ${fmt(p.v_total || 0)}</p>
        <p style="font-size:11px;color:var(--text3);">${new Date(p.created_at).toLocaleDateString('pt-BR')}</p>
      </div>
      <div style="display:flex;gap:8px;flex-direction:column;align-items:flex-end;">
        <span class="proposta-status ${p.status || 'ativa'}">${p.status === 'enviada' ? 'üì§ Enviada' : p.status === 'fechada' ? '‚úÖ Fechada' : 'üìù Ativa'}</span>
        <div class="proposta-actions">
          <button onclick="visualizarProposta('${p.id}')">üëÅ Ver</button>
          <button onclick="editarProposta('${p.id}')">‚úèÔ∏è Editar</button>
          <button onclick="deletarProposta('${p.id}')">üóë Deletar</button>
        </div>
      </div>
    </div>
  `).join('');
}

function visualizarProposta(id) {
  const p = allPropostas.find(x => x.id === id);
  if (!p) return;
  currentPropostaData = p;
  montarPreviewDeProposta(p);
  showPage('preview');
}

function editarProposta(id) {
  const p = allPropostas.find(x => x.id === id);
  if (!p) return;
  editingId = id;
  carregarFormDeProposta(p);
  document.getElementById('orcTitle').textContent = 'Editar Proposta';
  document.getElementById('btnSalvar').textContent = 'üíæ Salvar Altera√ß√µes';
  goStep(1);
  showPage('orcamento');
}

function carregarFormDeProposta(p) {
  set('c-nome', p.cliente_nome); set('c-wpp', p.cliente_wpp);
  set('c-end', p.cliente_end);   set('c-ref', p.cliente_ref);
  movelSelecionado = p.tipo_movel || 'Cozinha Planejada';
  document.querySelectorAll('#movelGrid .movel-card').forEach(c => {
    const lbl = c.querySelector('.ml').textContent;
    const map = {'Cozinha Planejada':'Cozinha','Guarda-Roupa':'Guarda-Roupa','Home Office':'Home Office','Closet':'Closet','Banheiro':'Banheiro','Rack / Painel TV':'Rack/Painel','Quarto Infantil':'Infantil','√Årea de Servi√ßo':'√Årea Servi√ßo','M√≥vel Sob Medida':'Sob Medida'};
    c.classList.toggle('on', lbl === (map[p.tipo_movel] || p.tipo_movel));
  });
  setChip('chapas', p.chapa); setChip('acabs', p.acabamento); setChip('ferragens', p.ferragens);
  set('m-detalhes', p.detalhes);
  fotosData = p.fotos || [];
  renderFotoGrid();
  medidas = [];
  document.getElementById('medidasList').innerHTML = '';
  (p.medidas || []).forEach(m => addMedida(m.nome, m.l, m.a, m.p));
  set('m-inicio', p.inicio || ''); set('m-entrega', p.entrega || '');
  set('m-prazo-obs', p.prazo_obs);
  set('v-mat', p.v_mat || ''); set('v-mao', p.v_mao || '');
  set('v-ferr', p.v_ferr || ''); set('v-outros', p.v_outros || '');
  set('v-margem', p.v_margem ?? 30);
  set('v-garantia', p.garantia); set('v-incluso', p.incluso); set('v-excluso', p.excluso);
  document.querySelectorAll('.pgto-card').forEach(c => {
    c.classList.toggle('on', (p.pgto_formas || []).includes(c.querySelector('.pl').textContent));
  });
  set('pg-condicao', p.pgto_condicao); set('pg-pix', p.pgto_pix);
  set('obs-final', p.obs_final);
  calcTotal();
}

function setChip(group, value) {
  document.querySelectorAll(`#${group} .chip`).forEach(c => {
    c.classList.toggle('on', c.textContent.trim() === (value || '').trim());
  });
}

function deletarProposta(id) {
  deleteTargetId = id;
  document.getElementById('modalDelete').classList.add('show');
}

async function confirmarDelete() {
  if (!deleteTargetId) return;
  const { error } = await sb.from('propostas').delete().eq('id', deleteTargetId);
  closeModal();
  if (error) { toast('‚ùå Erro ao excluir.'); return; }
  toast('üóë Proposta exclu√≠da.');
  deleteTargetId = null;
  await carregarPropostas();
}

function closeModal() {
  document.getElementById('modalDelete').classList.remove('show');
  deleteTargetId = null;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PREVIEW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function montarPreview() {
  const mat   = parseFloat(v('v-mat'))    || 0;
  const mao   = parseFloat(v('v-mao'))    || 0;
  const ferrV = parseFloat(v('v-ferr'))   || 0;
  const out   = parseFloat(v('v-outros')) || 0;
  const marg  = parseFloat(v('v-margem')) || 0;
  const sub   = mat + mao + ferrV + out;
  const total = sub + sub * (marg / 100);

  const p = {
    cliente_nome:  v('c-nome'), cliente_wpp: v('c-wpp'),
    cliente_end:   v('c-end'),  cliente_ref: v('c-ref'),
    tipo_movel:    movelSelecionado,
    chapa:         document.querySelector('#chapas .chip.on')?.textContent || '',
    acabamento:    document.querySelector('#acabs .chip.on')?.textContent || '',
    ferragens:     document.querySelector('#ferragens .chip.on')?.textContent || '',
    detalhes:      v('m-detalhes'),
    medidas:       medidas.map(id => ({ nome: document.getElementById('mn-'+id)?.value||'', l: document.getElementById('ml-'+id)?.value||'', a: document.getElementById('ma-'+id)?.value||'', p: document.getElementById('mp-'+id)?.value||'' })),
    inicio:        v('m-inicio'), entrega: v('m-entrega'), prazo_obs: v('m-prazo-obs'),
    v_total:       total,
    pgto_formas:   [...document.querySelectorAll('.pgto-card.on')].map(c => c.querySelector('.pl').textContent),
    pgto_condicao: v('pg-condicao'), pgto_pix: v('pg-pix'),
    garantia:      v('v-garantia'), incluso: v('v-incluso'), excluso: v('v-excluso'),
    obs_final:     v('obs-final'),
    numero:        editingId ? (allPropostas.find(x=>x.id===editingId)?.numero || 1) : orcNumBase,
    created_at:    new Date().toISOString()
  };
  currentPropostaData = p;
  montarPreviewDeProposta(p);
}

function montarPreviewDeProposta(p) {
  const hoje = new Date(p.created_at || Date.now()).toLocaleDateString('pt-BR');
  const num  = '#' + String(p.numero || 1).padStart(3,'0');

  s2('pv-titulo', 'Proposta ‚Äì ' + (p.tipo_movel || ''));
  s2('pv-num', num + ' ¬∑ ' + hoje);
  s2('pv-validade-txt', 'V√°lido por ' + (currentProfile.validade || 15) + ' dias');

  const logo = logoData || currentProfile.logo;
  const pvLogoBox = document.getElementById('pvLogoBox');
  pvLogoBox.innerHTML = logo
    ? `<img src="${logo}" style="max-height:26px;max-width:80px;object-fit:contain;">`
    : `<div class="logo-text">${currentProfile.nome || 'Marcenaria'}</div>`;

  s2('pv-marc-nome',   currentProfile.nome   || '‚Äî');
  s2('pv-marc-wpp',    currentProfile.wpp    || '‚Äî');
  s2('pv-marc-cidade', currentProfile.cidade || '‚Äî');
  s2('pv-c-nome', p.cliente_nome || '‚Äî');
  s2('pv-c-wpp',  p.cliente_wpp  || '‚Äî');
  s2('pv-c-end',  p.cliente_end  || '‚Äî');
  s2('pv-c-ref',  p.cliente_ref  || '');
  tog('pv-c-ref-row', !!p.cliente_ref);

  s2('pv-tipo', p.tipo_movel  || '‚Äî');
  s2('pv-mat',  p.chapa       || '‚Äî');
  s2('pv-acab', p.acabamento  || '‚Äî');
  s2('pv-ferr', p.ferragens   || '‚Äî');
  s2('pv-det',  p.detalhes    || '');
  tog('pv-det-row', !!p.detalhes);

  const tbody = document.getElementById('pv-med-body');
  tbody.innerHTML = '';
  let hasM = false;
  (p.medidas || []).forEach(m => {
    if (m.nome || m.l) {
      hasM = true;
      tbody.innerHTML += `<tr><td>${m.nome||'‚Äî'}</td><td>${m.l?m.l+'m':'‚Äî'}</td><td>${m.a?m.a+'m':'‚Äî'}</td><td>${m.p?m.p+'m':'‚Äî'}</td></tr>`;
    }
  });
  tog('pv-med-section', hasM);

  const ini = p.inicio  ? new Date(p.inicio +'T12:00').toLocaleDateString('pt-BR') : '‚Äî';
  const ent = p.entrega ? new Date(p.entrega+'T12:00').toLocaleDateString('pt-BR') : '‚Äî';
  s2('pv-inicio',    ini);
  s2('pv-entrega',   ent);
  s2('pv-prazo-obs', p.prazo_obs || '');
  tog('pv-prazo-obs-row', !!p.prazo_obs);

  s2('pv-total', fmt(p.v_total || 0));

  document.getElementById('pv-pgto-pills').innerHTML = (p.pgto_formas || []).map(f => `<div class="pgto-pill">${f}</div>`).join('');
  s2('pv-condicao', p.pgto_condicao || '‚Äî');
  tog('pv-condicao-row', !!p.pgto_condicao);
  s2('pv-pix', p.pgto_pix || '');
  tog('pv-pix-row', !!p.pgto_pix);

  s2('pv-garantia', p.garantia || '‚Äî');
  s2('pv-incluso',  p.incluso  || '‚Äî');
  s2('pv-excluso',  p.excluso  || '‚Äî');

  const pvFotos = document.getElementById('pv-fotos-section');
  const fotos   = p.fotos || fotosData;
  if (fotos && fotos.length > 0) {
    pvFotos.style.display = 'block';
    pvFotos.innerHTML = `<h3>Fotos de Refer√™ncia</h3><div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;">${fotos.map(src=>`<img src="${src}" style="width:72px;height:72px;object-fit:cover;border-radius:7px;border:1px solid var(--border);">`).join('')}</div>`;
  } else {
    pvFotos.style.display = 'none';
  }

  const obsEl = document.getElementById('pv-obs-section');
  if (p.obs_final) { document.getElementById('pv-obs').textContent = p.obs_final; obsEl.style.display = 'block'; }
  else obsEl.style.display = 'none';

  const rodapeEl = document.getElementById('pv-rodape-section');
  if (currentProfile.rodape) { document.getElementById('pv-rodape').textContent = currentProfile.rodape; rodapeEl.style.display = 'block'; }
  else rodapeEl.style.display = 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// WHATSAPP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function enviarWhatsApp() {
  const p    = currentPropostaData;
  const wpp  = (v('c-wpp') || p.cliente_wpp || '').replace(/\D/g,'');
  const mat  = parseFloat(v('v-mat'))||0, mao=parseFloat(v('v-mao'))||0,
        ferr = parseFloat(v('v-ferr'))||0, out2=parseFloat(v('v-outros'))||0, marg=parseFloat(v('v-margem'))||0;
  const sub  = mat+mao+ferr+out2;
  const total = p.v_total || (sub + sub*(marg/100));
  const pgtos = [...document.querySelectorAll('.pgto-card.on')].map(c=>c.querySelector('.pl').textContent).join(', ')
    || (p.pgto_formas||[]).join(', ');
  const cliente  = v('c-nome')     || p.cliente_nome || 'Cliente';
  const tipo     = movelSelecionado|| p.tipo_movel   || '';
  const end      = v('c-end')      || p.cliente_end  || '';
  const entrega  = v('m-entrega')  || p.entrega      || '';
  const condicao = v('pg-condicao')|| p.pgto_condicao|| '';
  const pix      = v('pg-pix')     || p.pgto_pix     || '';
  const garantia = v('v-garantia') || p.garantia     || '';
  const obs      = v('obs-final')  || p.obs_final    || '';
  const entFmt   = entrega ? new Date(entrega+'T12:00').toLocaleDateString('pt-BR') : 'a combinar';

  const msg =
`Ol√° ${cliente}! üëã

Segue sua proposta para o *${tipo}*:

üìç Local: ${end || 'a confirmar'}
üìÖ Entrega prevista: ${entFmt}

üí∞ *Valor Total: ${fmt(total)}*
‚è≥ V√°lido por ${currentProfile.validade || 15} dias

üí≥ Pagamento: ${pgtos}${condicao ? '\nüìã Condi√ß√£o: '+condicao : ''}${pix ? '\nüì± PIX: '+pix : ''}${garantia ? '\n‚úÖ Garantia: '+garantia : ''}${obs ? '\n\nüìù '+obs : ''}

Qualquer d√∫vida √© s√≥ chamar! ü™ö
${currentProfile.nome || ''}${currentProfile.wpp ? ' ‚Ä¢ '+currentProfile.wpp : ''}`;

  const url = wpp
    ? `https://wa.me/55${wpp}?text=${encodeURIComponent(msg)}`
    : `https://wa.me/?text=${encodeURIComponent(msg)}`;
  window.open(url, '_blank');

  // Marcar como enviada
  if (currentPropostaData.id) {
    sb.from('propostas').update({ status: 'enviada', updated_at: new Date().toISOString() })
      .eq('id', currentPropostaData.id).then(() => carregarPropostas());
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PDF PROFISSIONAL (NOVO LAYOUT)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function gerarPDF() {
  toast('‚è≥ Gerando PDF...');
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ orientation:'portrait', unit:'mm', format:'a4' });
  const W=210, H=297, M=15;
  
  const p = currentPropostaData;
  const logo = logoData || currentProfile.logo;
  const hoje = new Date(p.created_at || Date.now()).toLocaleDateString('pt-BR');
  const numStr = String(p.numero || 1).padStart(3,'0');
  const ini = p.inicio ? new Date(p.inicio +'T12:00').toLocaleDateString('pt-BR') : 'A combinar';
  const ent = p.entrega ? new Date(p.entrega+'T12:00').toLocaleDateString('pt-BR') : 'A combinar';
  
  let y = M;
  
  // ‚îÄ‚îÄ LOGO CIRCULAR NO TOPO ‚îÄ‚îÄ
  if (logo) {
    try {
      doc.addImage(logo, 'JPEG', W/2 - 15, y, 30, 30, '', 'FAST');
      y += 35;
    } catch(e) {}
  } else {
    doc.setFont('helvetica','bold');
    doc.setFontSize(24);
    doc.setTextColor(212, 43, 43);
    doc.text(currentProfile.nome?.charAt(0).toUpperCase() || '‚óè', W/2, y + 15, { align: 'center' });
    y += 35;
  }
  
  // ‚îÄ‚îÄ T√çTULO PRINCIPAL ‚îÄ‚îÄ
  doc.setFont('helvetica','bold');
  doc.setFontSize(18);
  doc.setTextColor(28, 28, 30);
  doc.text('PROPOSTA DE OR√áAMENTO PARA M√ìVEIS', W/2, y, { align: 'center' });
  doc.text('PLANEJADOS', W/2, y + 8, { align: 'center' });
  y += 18;
  
  // ‚îÄ‚îÄ LINHA DIVIS√ìRIA ‚îÄ‚îÄ
  doc.setDrawColor(212, 43, 43);
  doc.setLineWidth(0.5);
  doc.line(M, y, W - M, y);
  y += 6;
  
  // ‚îÄ‚îÄ INFORMA√á√ïES B√ÅSICAS ‚îÄ‚îÄ
  doc.setFont('helvetica','bold');
  doc.setFontSize(10);
  doc.setTextColor(28, 28, 30);
  doc.text(`Cliente: ${p.cliente_nome || '‚Äî'}`, M, y);
  y += 6;
  doc.text(`Localiza√ß√£o do Projeto: ${p.cliente_end || '‚Äî'}`, M, y);
  y += 6;
  doc.text(`Validade da Proposta: ${currentProfile.validade || 15} dias`, M, y);
  y += 10;
  
  // ‚îÄ‚îÄ DETALHAMENTO POR AMBIENTE ‚îÄ‚îÄ
  doc.setFont('helvetica','bold');
  doc.setFontSize(11);
  doc.setTextColor(212, 43, 43);
  doc.text('DETALHAMENTO POR AMBIENTE', M, y);
  y += 8;
  
  // Mostrar informa√ß√µes do m√≥vel
  doc.setFont('helvetica','bold');
  doc.setFontSize(10);
  doc.setTextColor(28, 28, 30);
  doc.text(`1. ${p.tipo_movel || 'M√≥vel'}`, M, y);
  y += 6;
  
  doc.setFont('helvetica','normal');
  doc.setFontSize(9);
  doc.setTextColor(72, 72, 74);
  
  // Medidas
  if (p.medidas && p.medidas.length > 0) {
    const medStr = p.medidas.map(m => `${m.nome} (${m.l}m L x ${m.a}m A x ${m.p}m P)`).join('; ');
    const medLines = doc.splitTextToSize(`Medidas: ${medStr}`, W - M*2 - 10);
    doc.text(medLines, M + 5, y);
    y += medLines.length * 4 + 2;
  }
  
  // Acabamento
  if (p.acabamento) {
    const acabLines = doc.splitTextToSize(`Acabamento: ${p.acabamento}`, W - M*2 - 10);
    doc.text(acabLines, M + 5, y);
    y += acabLines.length * 4 + 2;
  }
  
  // Ferragens
  if (p.ferragens) {
    const ferrLines = doc.splitTextToSize(`Puxadores: ${p.ferragens}`, W - M*2 - 10);
    doc.text(ferrLines, M + 5, y);
    y += ferrLines.length * 4 + 2;
  }
  
  // Subtotal
  doc.setFont('helvetica','bold');
  doc.setTextColor(212, 43, 43);
  doc.text(`Subtotal ${p.tipo_movel || 'M√≥vel'}: ${fmt(p.v_total || 0)}`, M + 5, y);
  y += 8;
  
  // ‚îÄ‚îÄ SUM√ÅRIO DE INVESTIMENTO ‚îÄ‚îÄ
  doc.setFont('helvetica','bold');
  doc.setFontSize(11);
  doc.setTextColor(212, 43, 43);
  doc.text('SUM√ÅRIO DE INVESTIMENTO', M, y);
  y += 8;
  
  // Tabela
  doc.setFont('helvetica','bold');
  doc.setFontSize(9);
  doc.setTextColor(255, 255, 255);
  doc.setFillColor(212, 43, 43);
  doc.rect(M, y - 5, W - M*2, 6, 'F');
  doc.text('Ambiente', M + 3, y);
  doc.text('Valor Total', W - M - 20, y, { align: 'right' });
  y += 8;
  
  doc.setFont('helvetica','normal');
  doc.setFontSize(9);
  doc.setTextColor(28, 28, 30);
  doc.setFillColor(248, 248, 248);
  doc.rect(M, y - 5, W - M*2, 6, 'F');
  doc.text(p.tipo_movel || 'M√≥vel', M + 3, y);
  doc.text(fmt(p.v_total || 0), W - M - 20, y, { align: 'right' });
  y += 8;
  
  // Total
  doc.setFont('helvetica','bold');
  doc.setFontSize(11);
  doc.setTextColor(212, 43, 43);
  doc.text(`INVESTIMENTO TOTAL: ${fmt(p.v_total || 0)}`, M, y);
  y += 10;
  
  // ‚îÄ‚îÄ CONDI√á√ïES COMERCIAIS ‚îÄ‚îÄ
  doc.setFont('helvetica','bold');
  doc.setFontSize(11);
  doc.setTextColor(212, 43, 43);
  doc.text('CONDI√á√ïES COMERCIAIS', M, y);
  y += 8;
  
  doc.setFont('helvetica','normal');
  doc.setFontSize(9);
  doc.setTextColor(28, 28, 30);
  
  if (p.pgto_condicao) {
    const pgtoLines = doc.splitTextToSize(p.pgto_condicao, W - M*2 - 10);
    doc.text(pgtoLines, M + 5, y);
    y += pgtoLines.length * 4 + 2;
  }
  
  if (p.pgto_pix) {
    const pixLines = doc.splitTextToSize(`PIX: ${p.pgto_pix}`, W - M*2 - 10);
    doc.text(pixLines, M + 5, y);
    y += pixLines.length * 4 + 2;
  }
  
  y += 2;
  
  // ‚îÄ‚îÄ INFORMA√á√ïES DE CONTATO ‚îÄ‚îÄ
  doc.setFont('helvetica','bold');
  doc.setFontSize(11);
  doc.setTextColor(212, 43, 43);
  doc.text('INFORMA√á√ïES DE CONTATO', M, y);
  y += 8;
  
  doc.setFont('helvetica','normal');
  doc.setFontSize(9);
  doc.setTextColor(28, 28, 30);
  doc.text(currentProfile.nome || 'Marcenaria', M + 5, y);
  y += 5;
  if (currentProfile.wpp) {
    doc.text(`Telefones: ${currentProfile.wpp}`, M + 5, y);
    y += 5;
  }
  if (currentProfile.cidade) {
    doc.text(`Cidade: ${currentProfile.cidade}`, M + 5, y);
    y += 5;
  }
  y += 3;
  
  // ‚îÄ‚îÄ CONSIDERA√á√ïES IMPORTANTES ‚îÄ‚îÄ
  doc.setFont('helvetica','bold');
  doc.setFontSize(11);
  doc.setTextColor(212, 43, 43);
  doc.text('CONSIDERA√á√ïES IMPORTANTES', M, y);
  y += 8;
  
  doc.setFont('helvetica','normal');
  doc.setFontSize(9);
  doc.setTextColor(28, 28, 30);
  
  if (p.excluso) {
    const exLines = doc.splitTextToSize(p.excluso, W - M*2 - 10);
    doc.text(exLines, M + 5, y);
    y += exLines.length * 4 + 2;
  } else {
    const defaultEx = 'Esta proposta n√£o contempla itens como tampos de pedra, cubas, eletrodom√©sticos, instala√ß√µes el√©tricas/hidr√°ulicas ou quaisquer outros elementos n√£o explicitamente mencionados.';
    const defLines = doc.splitTextToSize(defaultEx, W - M*2 - 10);
    doc.text(defLines, M + 5, y);
    y += defLines.length * 4 + 2;
  }
  
  y += 4;
  
  // ‚îÄ‚îÄ FECHAMENTO ‚îÄ‚îÄ
  doc.setFont('helvetica','normal');
  doc.setFontSize(9);
  doc.setTextColor(72, 72, 74);
  doc.text('Agradecemos a oportunidade de apresentar esta proposta.', M, y);
  
  // ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ
  doc.setFont('helvetica','normal');
  doc.setFontSize(8);
  doc.setTextColor(142, 142, 147);
  doc.text('Proposta gerada por Fifty+ | fiftymais.com.br', M, H - 10);
  
  const nome = (p.cliente_nome||'Cliente').replace(/\s/g,'_');
  doc.save('Proposta_'+nome+'_'+hoje.replace(/\//g,'-')+'.pdf');
  toast('‚úÖ PDF baixado!');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FORM HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function goStep(n) {
  document.querySelectorAll('.step-page').forEach((s,i) => s.style.display = i+1===n ? 'block' : 'none');
  document.querySelectorAll('.step-dot').forEach((d,i) => {
    d.classList.remove('active','done');
    if (i+1===n) d.classList.add('active');
    if (i+1<n)  d.classList.add('done');
  });
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function selectMovel(el, tipo) {
  document.querySelectorAll('#movelGrid .movel-card').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  movelSelecionado = tipo;
}

function toggleChip(el, group) {
  document.querySelectorAll(`#${group} .chip`).forEach(c => c.classList.remove('on'));
  el.classList.add('on');
}

function togglePgto(el) { el.classList.toggle('on'); }

function calcTotal() {
  const mat  = parseFloat(document.getElementById('v-mat')?.value)    || 0;
  const mao  = parseFloat(document.getElementById('v-mao')?.value)    || 0;
  const ferr = parseFloat(document.getElementById('v-ferr')?.value)   || 0;
  const out  = parseFloat(document.getElementById('v-outros')?.value) || 0;
  const marg = parseFloat(document.getElementById('v-margem')?.value) || 0;
  const sub  = mat+mao+ferr+out;
  const vm   = sub*(marg/100);
  const total = sub+vm;
  const mval = document.getElementById('v-margem-val');
  const spre = document.getElementById('v-subtotal-preview');
  const tpre = document.getElementById('v-total-preview');
  if (mval) mval.textContent = fmt(vm);
  if (spre) spre.textContent = fmt(sub);
  if (tpre) tpre.textContent = fmt(total);
}

function addMedida(nome='', l='', a='', p='') {
  const id = Date.now() + Math.random();
  medidas.push(id);
  const div = document.createElement('div');
  div.className = 'medida-item';
  div.id = 'med-'+id;
  div.innerHTML = `
    <input type="text" placeholder="Nome da pe√ßa / ambiente" value="${nome}" id="mn-${id}" autocorrect="off" style="margin-bottom:0;">
    <div class="medida-dims">
      <div class="dim-wrap">
        <label>Larg.</label>
        <input type="number" placeholder="0.00" value="${l}" id="ml-${id}" min="0" step="0.01" inputmode="decimal">
      </div>
      <div class="dim-wrap">
        <label>Alt.</label>
        <input type="number" placeholder="0.00" value="${a}" id="ma-${id}" min="0" step="0.01" inputmode="decimal">
      </div>
      <div class="dim-wrap">
        <label>Prof.</label>
        <input type="number" placeholder="0.00" value="${p}" id="mp-${id}" min="0" step="0.01" inputmode="decimal">
      </div>
      <button class="btn-rm-medida" onclick="removeMedida('${id}')">‚úï</button>
    </div>`;
  document.getElementById('medidasList').appendChild(div);
}

function removeMedida(id) {
  document.getElementById('med-'+id)?.remove();
  medidas = medidas.filter(m => m !== id);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function v(id)       { return document.getElementById(id)?.value || ''; }
function set(id,val) { const el=document.getElementById(id); if(el) el.value=val??''; }
function s2(id,val)  { const el=document.getElementById(id); if(el) el.textContent=val||''; }
function tog(id,show){ const el=document.getElementById(id); if(el) el.style.display=show?'':'none'; }
function fmt(val)    { return 'R$ '+(val||0).toFixed(2).replace('.',',').replace(/\B(?=(\d{3})+(?!\d))/g,'.'); }

function toast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2800);
}

function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  [...document.querySelectorAll('.tab-btn')].find(b => b.textContent.toLowerCase().includes(name === 'orcamento' ? 'or√ßamento' : name === 'propostas' ? 'propostas' : 'perfil'))?.classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
window.addEventListener('load', verificarAuth);

// Fechar modal ao clicar fora
document.getElementById('modalDelete').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
</script>
</body>
</html>
Executing Uploaded File Content - Manus
